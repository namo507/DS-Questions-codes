---
title: "Best Time to Buy and Sell Stock"
subtitle: "LeetCode #121 | Easy | Arrays & Dynamic Programming"
format:
  pdf:
    toc: true
    number-sections: true
    colorlinks: true
    code-block-bg: "#f5f5f5"
---

# üèãÔ∏è Problem Statement

**LeetCode #121 - Best Time to Buy and Sell Stock**

You are given an array `prices` where `prices[i]` is the price of a given stock on the $i^{th}$ day.

You want to maximize your profit by choosing a **single day** to buy one stock and choosing a **different day in the future** to sell that stock.

Return the **maximum profit** you can achieve from this transaction. If you cannot achieve any profit, return `0`.

## Examples

| Example | Input | Output | Explanation |
|:--------|:------|:-------|:------------|
| 1 | `[7, 1, 5, 3, 6, 4]` | `5` | Buy on day 2 (price=1), sell on day 5 (price=6), profit = 6-1 = 5 |
| 2 | `[7, 6, 4, 3, 1]` | `0` | Prices only decrease, no profitable transaction possible |

## Constraints

- $1 \leq \text{prices.length} \leq 10^5$
- $0 \leq \text{prices}[i] \leq 10^4$

## Companies That Ask This

| Company | Frequency |
|:--------|:----------|
| Amazon | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| Meta | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| Goldman Sachs | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| Microsoft | ‚≠ê‚≠ê‚≠ê‚≠ê |
| Google | ‚≠ê‚≠ê‚≠ê‚≠ê |
| Bloomberg | ‚≠ê‚≠ê‚≠ê‚≠ê |

---

# üèãÔ∏è The Gym Metaphor: Tracking Your Fitness Journey

## Understanding the Problem Through Fitness

Imagine you're tracking your **body weight** over several weeks to find the **best transformation period**:

```
Week:     1    2    3    4    5    6
Weight: [85kg, 78kg, 82kg, 80kg, 75kg, 77kg]
```

**The Goal**: Find the period where you achieved the **maximum weight loss** (starting weight - ending weight).

**Key Rules**:

1. You can only calculate loss from an **earlier** week to a **later** week (time only moves forward!)
2. You want the **biggest drop** possible
3. If you only gained weight throughout, your "best loss" is 0 (no negative results)

---

## The Naive Approach: Comparing Every Pair of Weeks

Like obsessively comparing every possible combination:

```
Week 1 to Week 2: 85 - 78 = 7 kg loss ‚úì
Week 1 to Week 3: 85 - 82 = 3 kg loss ‚úì
Week 1 to Week 4: 85 - 80 = 5 kg loss ‚úì
...
Week 2 to Week 3: 78 - 82 = -4 (gained weight, ignore)
...
```

This requires checking every pair ‚Üí **O(n¬≤) comparisons** ‚Äî exhausting!

---

## The Smart Approach: The Personal Best Tracker

Here's how a smart fitness coach would think:

> **"Keep track of your LOWEST weight so far, and at each weigh-in, calculate your potential loss from that lowest point."**

### The Coach's Strategy:

1. **Track the minimum price seen so far** (your "personal best low")
2. **At each day, calculate profit if you sold today** (current price - min so far)
3. **Keep track of maximum profit seen** (your best transformation)

### Visual Walkthrough

```
Prices: [7, 1, 5, 3, 6, 4]
Day:     0  1  2  3  4  5

Day 0: Price=7, Min so far=7, Profit if sell=0,  Max profit=0
Day 1: Price=1, Min so far=1, Profit if sell=0,  Max profit=0  (new low!)
Day 2: Price=5, Min so far=1, Profit if sell=4,  Max profit=4
Day 3: Price=3, Min so far=1, Profit if sell=2,  Max profit=4
Day 4: Price=6, Min so far=1, Profit if sell=5,  Max profit=5  ‚≠ê NEW BEST!
Day 5: Price=4, Min so far=1, Profit if sell=3,  Max profit=5

Answer: 5
```

| Day | Price | Min So Far | Potential Profit | Max Profit | Notes |
|:----|:------|:-----------|:-----------------|:-----------|:------|
| 0 | 7 | 7 | 7 - 7 = 0 | 0 | Starting point |
| 1 | 1 | 1 | 1 - 1 = 0 | 0 | New lowest! üìâ |
| 2 | 5 | 1 | 5 - 1 = 4 | 4 | Good profit! |
| 3 | 3 | 1 | 3 - 1 = 2 | 4 | Not better |
| 4 | 6 | 1 | 6 - 1 = 5 | **5** | Best profit! üèÜ |
| 5 | 4 | 1 | 4 - 1 = 3 | 5 | Stay at best |

---

# üíª Python Solution

```{python}
def max_profit(prices: list[int]) -> int:
    """
    Find maximum profit from single buy-sell transaction.
    
    The Personal Best Tracker Strategy:
    - Track your lowest weight (buy price) seen so far
    - At each weigh-in (day), calculate potential gain
    - Keep track of your best transformation (max profit)
    
    Time Complexity: O(n) - One walk through your fitness journey
    Space Complexity: O(1) - Just tracking two numbers
    """
    if not prices or len(prices) < 2:
        return 0
    
    # Your personal best low weight (lowest buy price seen)
    min_price = prices[0]
    
    # Your best transformation result (maximum profit)
    max_profit_value = 0
    
    # Walk through each weigh-in day
    for price in prices:
        # Is this a new personal low?
        if price < min_price:
            min_price = price
        
        # What would be my profit if I sold today?
        potential_profit = price - min_price
        
        # Is this my best transformation yet?
        if potential_profit > max_profit_value:
            max_profit_value = potential_profit
    
    return max_profit_value


# Test cases
print("Example 1:", max_profit([7, 1, 5, 3, 6, 4]))  # 5
print("Example 2:", max_profit([7, 6, 4, 3, 1]))     # 0


# Alternative: More Pythonic One-liner style
def max_profit_pythonic(prices: list[int]) -> int:
    """Compact version using running minimum."""
    min_price = float('inf')
    max_profit_val = 0
    
    for price in prices:
        min_price = min(min_price, price)
        max_profit_val = max(max_profit_val, price - min_price)
    
    return max_profit_val


print("Pythonic Example 1:", max_profit_pythonic([7, 1, 5, 3, 6, 4]))  # 5
```

---

# üìä R Solution

```{r}
max_profit <- function(prices) {
  #' Find maximum profit from single buy-sell transaction.
  #' 
  #' The Personal Best Tracker Strategy:
  #' - Track your lowest weight (buy price) seen so far
  #' - At each weigh-in (day), calculate potential gain
  #' - Keep track of your best transformation (max profit)
  #' 
  #' Time Complexity: O(n) - One walk through your fitness journey
  #' Space Complexity: O(1) - Just tracking two numbers
  
  if (length(prices) < 2) {
    return(0)
  }
  
  # Your personal best low weight (lowest buy price seen)
  min_price <- prices[1]
  
  # Your best transformation result (maximum profit)
  max_profit_value <- 0
  
  # Walk through each weigh-in day (starting from day 2 in R)
  for (price in prices) {
    # Is this a new personal low?
    if (price < min_price) {
      min_price <- price
    }
    
    # What would be my profit if I sold today?
    potential_profit <- price - min_price
    
    # Is this my best transformation yet?
    if (potential_profit > max_profit_value) {
      max_profit_value <- potential_profit
    }
  }
  
  return(max_profit_value)
}


# Test cases
cat("Example 1:", max_profit(c(7, 1, 5, 3, 6, 4)), "\n")  # 5
cat("Example 2:", max_profit(c(7, 6, 4, 3, 1)), "\n")     # 0


# Vectorized R approach
max_profit_vectorized <- function(prices) {
  if (length(prices) < 2) return(0)
  
  # Calculate cumulative minimum
  cum_min <- cummin(prices)
  
  # Calculate profit at each point
  profits <- prices - cum_min
  
  # Return maximum profit
  return(max(profits))
}


cat("Vectorized Example 1:", max_profit_vectorized(c(7, 1, 5, 3, 6, 4)), "\n")  # 5
```

---

# üîç Solution Breakdown: The Full Fitness Analysis

## Algorithm Walkthrough with Detailed Table

Let's trace through **Example 1**: `prices = [7, 1, 5, 3, 6, 4]`

| Day | Current Price | Operation | Min Price After | Profit if Sell Today | Max Profit After | Logic |
|:----|:--------------|:----------|:----------------|:---------------------|:-----------------|:------|
| 0 | 7 | Initialize | 7 | 0 | 0 | First day, set baseline |
| 1 | 1 | Update min | **1** | 0 | 0 | Found cheaper entry! |
| 2 | 5 | Calculate profit | 1 | 4 | **4** | Profit = 5-1 = 4 |
| 3 | 3 | Calculate profit | 1 | 2 | 4 | 2 < 4, keep old max |
| 4 | 6 | Calculate profit | 1 | 5 | **5** | New best! üèÜ |
| 5 | 4 | Calculate profit | 1 | 3 | 5 | 3 < 5, keep best |

**Final Answer**: `5` (Buy at 1, Sell at 6)

---

## The Gym Metaphor Breakdown

| Coding Concept | Fitness Equivalent |
|:---------------|:-------------------|
| `prices` array | Daily weigh-ins on your fitness journey |
| `min_price` | Your personal best (lowest) weight |
| `max_profit` | Your best transformation (maximum weight loss) |
| Iterating through prices | Walking through your fitness calendar |
| Updating `min_price` | "New personal low! Let's see what gains we can make from here" |
| Calculating `price - min_price` | "If I ended my cut here, how much would I have lost?" |
| Constraint: sell after buy | You can't time-travel; progress is measured forward |

---

## Why This Works: The Fitness Logic

### Key Insight 1: We Only Need the Minimum So Far

Why? Because the **maximum profit** ending at day $i$ can only come from buying at the **cheapest price** in days $[0, i-1]$.

**Gym Translation**: The best transformation ending today must have started from your lowest recorded weight in the past.

### Key Insight 2: One Pass is Enough

At each day, we either:
1. Find a new lowest price (potential better buy point)
2. Find a new maximum profit (potential best sell point)

We don't need to go back because we're **always tracking the best of everything seen so far**.

---

## Decreasing Price Scenario

Let's trace **Example 2**: `prices = [7, 6, 4, 3, 1]`

| Day | Price | Min Price | Profit | Max Profit | Notes |
|:----|:------|:----------|:-------|:-----------|:------|
| 0 | 7 | 7 | 0 | 0 | Start |
| 1 | 6 | 6 | 0 | 0 | New min, but no profit |
| 2 | 4 | 4 | 0 | 0 | New min, still no profit |
| 3 | 3 | 3 | 0 | 0 | New min, still no profit |
| 4 | 1 | 1 | 0 | 0 | New min, still no profit |

**Result**: `0` ‚Äî Like a bulk phase where you only gained weight, no "loss" to report!

---

# üìà Complexity Analysis

## Time Complexity: O(n)

| Operation | Frequency | Cost | Total |
|:----------|:----------|:-----|:------|
| Iterate through prices | n times | O(1) | O(n) |
| Compare and update min | n times | O(1) | O(n) |
| Compare and update max | n times | O(1) | O(n) |

**Total**: O(n) ‚Äî One complete walk through your fitness journal

## Space Complexity: O(1)

| Variable | Space | Purpose |
|:---------|:------|:--------|
| `min_price` | O(1) | Track lowest price seen |
| `max_profit` | O(1) | Track best profit seen |

**Total**: O(1) ‚Äî Just two numbers, like carrying a notepad with "lowest weight" and "best loss" 

---

# üéØ Key Takeaways

## Pattern Recognition: Kadane's Algorithm Variant

This problem is a classic application of **tracking running min/max**:

> **At each step, maintain the best "prefix" information needed to compute the optimal answer.**

## The One-Pass Trick

| What We Track | Why |
|:--------------|:----|
| Minimum so far | Best possible buy price for any future sell |
| Maximum profit so far | Best result we've found |

## Common Mistakes to Avoid

| Mistake | Why It's Wrong | Correct Approach |
|:--------|:---------------|:-----------------|
| Using nested loops | O(n¬≤) when O(n) is possible | Use running minimum |
| Forgetting the order constraint | Can't sell before buying | Min is from past, current is potential sell |
| Returning negative profit | Problem says return 0 if no profit | Initialize max_profit to 0 |

---

# üèÜ Practice Variations

Once you master this, try these progressively harder stock problems:

| Problem | Difficulty | Key Difference |
|:--------|:-----------|:---------------|
| Best Time II (Multiple Transactions) | Medium | Can buy/sell multiple times |
| Best Time III (At Most 2 Transactions) | Hard | Limited to 2 buy-sells |
| Best Time IV (At Most K Transactions) | Hard | Generalized to K transactions |
| Best Time with Cooldown | Medium | Must wait 1 day after selling |
| Best Time with Transaction Fee | Medium | Fee charged on each sell |

---

# üßÆ Mathematical Formulation

For the mathematically inclined:

$$\text{Max Profit} = \max_{0 \leq i < j \leq n-1} (prices[j] - prices[i])$$

Which can be computed in one pass as:

$$\text{Max Profit} = \max_{j} \left( prices[j] - \min_{i < j} prices[i] \right)$$

---

*"Track your personal bests, and the gains will follow. In trading and fitness, consistency and patience win."* üí™üìà
